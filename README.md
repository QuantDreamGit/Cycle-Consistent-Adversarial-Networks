
# Self-supervised Text Style Transfer using Cycle-Consistent Adversarial Networks
This repository contains the code for the paper [Self-supervised Text Style Transfer using Cycle-Consistent Adversarial Networks](https://dl.acm.org/doi/10.1145/3678179), published in ACM Transactions on Intelligent Systems and Technology.

It includes the Python package to train and test the CycleGAN architecture for Text Style Transfer as described in the paper.

## Installation
Clone the project:

```code
git clone https://github.com/gallipoligiuseppe/TST-CycleGAN.git

# To install dependencies, refer to the `env.yml` file:
conda create -f env.yml -n cyclegan_tst
conda activate cyclegan_tst
```
If any dependencies are missing, please open an issue.

## Usage
The package provides scripts to train and test the CycleGAN architecture for Text Style Transfer, focusing on *formality* (informal â†” formal) and *sentiment* (negative â†” positive) transfer tasks.

## Data
### Formality Transfer
Refer to the dataset license and request access to the [GYAFC](https://aclanthology.org/N18-1012/) dataset following the steps in its [repository](https://github.com/raosudha89/GYAFC-corpus).

### Sentiment Transfer
We use the [Yelp](https://papers.nips.cc/paper_files/paper/2017/hash/2d2c8394e31101a261abf1784302bf75-Abstract.html) dataset with splits as per [Li et al.](https://aclanthology.org/N18-1169/) available in their [repository](https://github.com/lijuncen/Sentiment-and-Style-Transfer).

---

## Training and Testing
You can train the CycleGAN model using `train.py` and evaluate it using `test.py`.

### New Experiments
Three different configurations were added for the Yelp sentiment transfer task:

1. **Original** â€“ Using 40K samples from the original dataset.
2. **Augmented** â€“ 50% original and 50% ChatGPT-4o mini-generated sentences.
3. **Synthetic** â€“ Fully synthetic data generated by ChatGPT.

These experiments allow us to analyze the impact of different training datasets on model performance. Full results can be found on [Comet](https://www.comet.com/quantdreamgit/cyclegan-augmentation/reports/final-results).

### Training Commands

#### **Original Dataset**
```bash
CUDA_VISIBLE_DEVICES=0 python train.py \
    --style_a=neg --style_b=pos --lang=en \
    --path_mono_A=./data/yelp/train.0.txt \
    --path_mono_B=./data/yelp/train.1.txt \
    --path_paral_A_eval=./data/yelp/dev.0.txt \
    --path_paral_B_eval=./data/yelp/dev.1.txt \
    --path_paral_eval_ref=./data/yelp/references/test/ \
    --generator_model_tag=google-t5/t5-small \
    --discriminator_model_tag=distilbert-base-cased \
    --pretrained_classifier_model=ggallipoli/sentiment_classifier_yelp \
    --n_references=4 \
    --lambdas="10|1|1|1|1" \
    --epochs=10 \
    --learning_rate=1e-3 \
    --max_sequence_length=64 \
    --batch_size=64 \
    --num_workers=2 \
    --save_base_folder=./ckpts_yelp/ \
    --save_steps=1 \
    --eval_strategy=epochs \
    --eval_steps=1 \
    --pin_memory \
    --max_samples_train=40000 \
    --shuffle \
    --use_cuda_if_available
```

#### **Augmented Dataset (50% Original + 50% Synthetic)**
```bash
CUDA_VISIBLE_DEVICES=0 python train.py \
    --style_a=neg --style_b=pos --lang=en \
    --path_mono_A=./data/yelp/train_augmented.0.txt \
    --path_mono_B=./data/yelp/train_augmented.1.txt \
    --path_paral_A_eval=./data/yelp/dev.0.txt \
    --path_paral_B_eval=./data/yelp/dev.1.txt \
    --path_paral_eval_ref=./data/yelp/references/test/ \
    --generator_model_tag=google-t5/t5-small \
    --discriminator_model_tag=distilbert-base-cased \
    --pretrained_classifier_model=ggallipoli/sentiment_classifier_yelp \
    --n_references=4 \
    --lambdas="10|1|1|1|1" \
    --epochs=10 \
    --learning_rate=1e-3 \
    --max_sequence_length=64 \
    --batch_size=64 \
    --num_workers=2 \
    --save_base_folder=./ckpts_yelp_augmented/ \
    --save_steps=1 \
    --eval_strategy=epochs \
    --eval_steps=1 \
    --pin_memory \
    --shuffle \
    --use_cuda_if_available
```

#### **Fully Synthetic Dataset**
```bash
CUDA_VISIBLE_DEVICES=0 python train.py \
    --style_a=neg --style_b=pos --lang=en \
    --path_mono_A=./data/yelp/train_synthetic.0.txt \
    --path_mono_B=./data/yelp/train_synthetic.1.txt \
    --path_paral_A_eval=./data/yelp/dev.0.txt \
    --path_paral_B_eval=./data/yelp/dev.1.txt \
    --path_paral_eval_ref=./data/yelp/references/test/ \
    --generator_model_tag=google-t5/t5-small \
    --discriminator_model_tag=distilbert-base-cased \
    --pretrained_classifier_model=ggallipoli/sentiment_classifier_yelp \
    --n_references=4 \
    --lambdas="10|1|1|1|1" \
    --epochs=10 \
    --learning_rate=1e-3 \
    --max_sequence_length=64 \
    --batch_size=64 \
    --num_workers=2 \
    --save_base_folder=./ckpts_yelp_synthetic/ \
    --save_steps=1 \
    --eval_strategy=epochs \
    --eval_steps=1 \
    --pin_memory \
    --shuffle \
    --use_cuda_if_available
```

### Testing Command (Common for All Experiments)
```bash
CUDA_VISIBLE_DEVICES=0 python test.py \
    --style_a=neg --style_b=pos --lang=en \
    --path_paral_A_test=./data/yelp/test.0.txt \
    --path_paral_B_test=./data/yelp/test.1.txt \
    --path_paral_test_ref=./data/yelp/references/test/ \
    --n_references=4 \
    --generator_model_tag=t5-small \
    --discriminator_model_tag=distilbert-base-cased \
    --pretrained_classifier_eval=ggallipoli/sentiment_classifier_yelp \
    --from_pretrained=./ckpts_yelp_[experiment_directory]/ \
    --max_sequence_length=64 \
    --batch_size=256 \
    --num_workers=2 \
    --use_cuda_if_available
```

---

## Model Checkpoints
All model checkpoints are available on Hugging Face ðŸ¤— at this [collection](https://huggingface.co/collections/ggallipoli/text-style-transfer-674b4bf7faef0be38154e535) for sentiment classifier.

## License
[Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-nc-sa/4.0/)

## Authors
[Moreno La Quatra](https://mlaquatra.me/), [Giuseppe Gallipoli](https://scholar.google.com/citations?user=uMRKRW0AAAAJ&hl=it), [Luca Cagliero](https://scholar.google.it/citations?user=0uIAXl8AAAAJ&hl=it)

### Corresponding Author
For questions, contact: giuseppe[DOT]gallipoli[AT]polito[DOT]it.

## Citation
If you use this work, please cite:

```bibtex
@article{LaQuatra24TST,
author = {La Quatra, Moreno and Gallipoli, Giuseppe and Cagliero, Luca},
title = {Self-supervised Text Style Transfer Using Cycle-Consistent Adversarial Networks},
year = {2024},
journal = {ACM Trans. Intell. Syst. Technol.},
doi = {10.1145/3678179}
}
```
```

### Summary of Modifications:
- **Added three new training setups** (Original, Augmented, Synthetic) with different datasets.
- **Updated training commands** to include the new dataset variations.
- **Linked Comet results** for experiment tracking.
- **Explained the rationale** behind these new tests to analyze the impact of synthetic data.

This README now reflects the latest changes while keeping everything clear and structured. ðŸš€